# Base image
BASE_IMAGE="../nvidia_cc_base/nvcc_image.qcow2"
OUTPUT_IMAGE="nvflare_cc_base.qcow2"
DEFAULT_SIZE="10G"

# Python settings
PYTHON_VERSION="3.9"
VENV_PATH="/opt/nvflare/venv"

# NVFLARE settings
NVFLARE_VERSION="2.6.0"
NVFLARE_HOME="/opt/nvflare"
NVFLARE_USER="nvflare"
NVFLARE_GROUP="nvflare"

# Directory Security Levels:
# RW  - Read/Write at runtime
# RO  - Read-only at runtime (enforced by mount options)
# DMV - dm-verity protected at runtime (cryptographic integrity)
# ENC - Static encryption (encrypted at rest)
# DENC - Dynamic encryption (encrypted with runtime key)

# Role Types:
# ALL    - Both FL server and client components
# CLIENT - FL client (trainer) components only
# SERVER - FL server (aggregator) components only

# Partition Mapping:
# p1 - EFI System Partition
# p2 - /boot partition
# p3 - Root partition (LUKS): Core installation, read-only components
# p4 - Config partition (dm-verity)
# p5 - Dynamic partition (LUKS): User-provided key encryption
# p6 - Data partition (unencrypted): User data access

# Partition Labels:
NVFLARE_ROOT_LABEL="nvflare-root"      # LUKS: Core installation
NVFLARE_CONFIG_LABEL="nvflare-config"   # dm-verity: Configs
NVFLARE_DYNAMIC_LABEL="nvflare-dynamic" # LUKS: Dynamic data
NVFLARE_DATA_LABEL="nvflare-data"       # Unencrypted: User data

# Mount Points
NVFLARE_ROOT_MOUNT="/opt/nvflare"                  # p3
NVFLARE_CONFIG_MOUNT="/opt/nvflare/config"         # p4
NVFLARE_DYNAMIC_MOUNT="/opt/nvflare/dynamic"       # p5
NVFLARE_DATA_MOUNT="/opt/nvflare/data"            # p6

#
# Exposed internal to TEE
#

# Root Partition (p3) components
# LUKS encrypted, system key
NVFLARE_HOME="${NVFLARE_ROOT_MOUNT}"              # Base directory
VENV_PATH="${NVFLARE_ROOT_MOUNT}/venv"            # Python environment
NVFLARE_STARTUP_DIR="${NVFLARE_CONFIG_MOUNT}/startup"
NVFLARE_STARTUP_SECURITY="RO,DMV"
NVFLARE_SITE_CONF_DIR="${NVFLARE_CONFIG_MOUNT}/site_conf"
NVFLARE_SITE_CONF_SECURITY="RO,DMV"
NVFLARE_JOB_STORE_KEY="${NVFLARE_CONFIG_MOUNT}/job_store_key/key_file.txt"
NVFLARE_JOB_STORE_KEY_SECURITY="RO,DMV"

# Root Partition (p3) components - Static Encryption
# LUKS encrypted, system key
NVFLARE_WORKSPACE="${NVFLARE_DYNAMIC_MOUNT}/workspace"
NVFLARE_WORKSPACE_SECURITY="RW,ENC"      # Static encryption with partition key

NVFLARE_LOG_DIR="${NVFLARE_DYNAMIC_MOUNT}/logs"
NVFLARE_LOG_SECURITY="RW,ENC"            # Static encryption with partition key

# Dynamic Partition (p5) components
# LUKS encrypted, user-provided key
NVFLARE_JOB_STORE_DIR="${NVFLARE_DYNAMIC_MOUNT}/job_store"
NVFLARE_JOB_STORE_SECURITY="RW,DENC"     # Dynamic encryption with user key

# Config Partition (p4) components
# dm-verity protected, read-only
NVFLARE_DATA_DIR="${NVFLARE_DATA_MOUNT}"
NVFLARE_DATA_SECURITY="RO"     # Enforced at runtime

# Directory structure summary:
# p3 (Root, LUKS)
#   /opt/nvflare/
#   └── venv/
#
# p4 (Config, dm-verity)
#   /opt/nvflare/config/
#   ├── startup/
#   ├── site_conf/
#   └── job_store_key/
#
# p5 (Dynamic, LUKS)
#   /opt/nvflare/dynamic/
#   ├── workspace/
#   ├── logs/
#   └── job_store/
#
# p6 (Data, unencrypted)
#   /opt/nvflare/data/
