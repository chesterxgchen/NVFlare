# NVFLARE Security Configuration

# Network security for FL ports (required)
# Format: "port:protocol:direction:description"
ALLOWED_PORTS=(
    # FL Communication (required)
    "8002:tcp:bidirectional:FL training"    # FL training communication
    "8003:tcp:bidirectional:Admin API"      # Admin API communication
)

# Monitoring Configuration
# Note: Uncomment ONE monitoring option as needed

# Format: "name:port:protocol:direction:description"
MONITORING_PORTS=(
    # System Monitoring
    #"statsd:9102:tcp:outbound:System metrics export"    # StatsD exporter
    
    # ML Metrics (enable only one)
    #"tensorboard:6006:tcp:outbound:ML visualization"    # TensorBoard
    #"mlflow:5000:tcp:outbound:ML experiment tracking"   # MLflow
    #"wandb:8088:tcp:outbound:ML experiment tracking"    # Weights & Biases
)

# Attestation configuration
# Format: "service:port:protocol:endpoint:description"
ATTESTATION_SERVICES=(
    "ITA:9000:tcp:api.trustedservices.intel.com:Intel Trust Authority"
    "SNP:9001:tcp:kdsintf.amd.com:AMD SEV-SNP Guest"
    "MAA:9002:tcp:sharedeus.eus.attest.azure.net:Azure MAA"
    "NRAS:9003:tcp:nras.nvidia.com:NVIDIA Remote Attestation"
)

# Network restrictions
ALLOWED_INTERFACES=(
    "lo"      # Loopback
    "eth0"    # Primary network
    "ens*"    # Cloud provider interfaces
)

# Connection and Rate Limits
MAX_CONNECTIONS=(
    "fl:20"              # FL training connections
    "admin:5"            # Admin connections
    "monitor:5"          # Monitoring connections
    "attestation:10"     # Attestation connections
)

# Rate limiting rules
# Format: "port:rate:description"
RATE_LIMIT_RULES=(
    "8002:10/minute:FL training"     # Limit FL training requests
    "8003:10/minute:Admin API"       # Limit admin access
)

# Network hardening parameters
NETWORK_HARDENING=(
    # Connection tracking
    "net.netfilter.nf_conntrack_max=131072"
    "net.netfilter.nf_conntrack_tcp_timeout_established=7200"
    
    # TCP hardening for FL communication
    "net.ipv4.tcp_max_syn_backlog=8192"
    "net.ipv4.tcp_slow_start_after_idle=0"
    "net.ipv4.tcp_tw_reuse=1"
    
    # Buffer tuning for FL workloads
    "net.core.rmem_max=16777216"
    "net.core.wmem_max=16777216"
    "net.ipv4.tcp_rmem=4096 87380 16777216"
    "net.ipv4.tcp_wmem=4096 87380 16777216"
)

# Security audit configuration
AUDIT_RULES=(
    "-w /etc/nvflare/config -p wa -k fl_config_changes"
    "-w /etc/nvflare/keys -p wa -k fl_key_access"
    "-w /var/log/nvflare -p wa -k fl_log_changes"
    "-a exit,always -F arch=b64 -S execve -F exe=/opt/nvflare/bin/* -k fl_exec"
)

# Process resource limits
PROCESS_LIMITS=(
    "nvflare soft nproc 1024"
    "nvflare hard nproc 2048"
    "nvflare soft nofile 4096"
    "nvflare hard nofile 8192"
    "nvflare hard core 0"
)

# Default security policy
DEFAULT_PORT_POLICY="deny"  # Deny all ports except those explicitly allowed
