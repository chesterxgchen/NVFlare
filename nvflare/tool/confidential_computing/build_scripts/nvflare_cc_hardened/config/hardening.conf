# System hardening configuration

# Services to disable
DISABLE_SERVICES=(
    "ssh"
    "telnet"
    "ftp"
    "rpcbind"
    "nfs-server"
    "cups"
    "avahi-daemon"
    "bluetooth"
)

# Network security
ALLOWED_PORTS=(
    "8002:tcp:FL training"
    "8003:tcp:Federation"
    "8004:tcp:Admin API"
    "8005:tcp:Metrics"
)

# Rate limiting
RATE_LIMIT_RULES=(
    "8002:10/minute:FL training"
    "8003:10/minute:Federation"
    "8004:5/minute:Admin API"
)

# Mount points with security options
SECURE_MOUNTS=(
    "/tmp:noexec,nosuid,nodev"
    "/dev/shm:noexec,nosuid,nodev"
    "/var/tmp:noexec,nosuid,nodev"
)

# Audit configuration
AUDIT_LOG="/var/log/nvflare/audit.log"
AUDIT_RULES=(
    "-w /etc/nvflare/config -p wa -k fl_config_changes"
    "-w /etc/nvflare/keys -p wa -k fl_key_access"
    "-w /var/log/nvflare -p wa -k fl_log_changes"
    "-a exit,always -F arch=b64 -S execve -F exe=/opt/nvflare/bin/* -k fl_exec"
)
AUDIT_BACKUP="/var/log/nvflare/audit.backup"

# Security monitoring
MONITOR_DIRS=(
    "/etc/nvflare/config"
    "/etc/nvflare/keys"
    "/var/log/nvflare"
)

# File integrity monitoring
AIDE_RULES=(
    "/etc/nvflare/config CONTENT_EX"
    "/etc/nvflare/keys PERMS"
    "/var/log/nvflare LOG"
)

# Process restrictions
PROCESS_LIMITS=(
    "nvflare soft nproc 1024"
    "nvflare hard nproc 2048"
    "nvflare soft nofile 4096"
    "nvflare hard nofile 8192"
    "nvflare hard core 0"
)

# Memory protection
MEMORY_PROTECTION=(
    "kernel.randomize_va_space=2"
    "kernel.kptr_restrict=2"
    "kernel.dmesg_restrict=1"
)

# Network hardening
NETWORK_HARDENING=(
    "net.ipv4.tcp_syncookies=1"
    "net.ipv4.icmp_echo_ignore_broadcasts=1"
    "net.ipv4.conf.all.accept_redirects=0"
)

# Mount points
INPUT_MOUNT="/mnt/data/nvflare/input"
OUTPUT_MOUNT="/mnt/data/nvflare/output"

# Encryption
LUKS_KEYFILE="/etc/nvflare/keys/luks.key"
LUKS_CIPHER="aes-xts-plain64"
LUKS_KEYSIZE="512" 