# OS Configuration
OS_VERSION="22.04"
OS_CODENAME="jammy"
LANGUAGE="en_US.UTF-8"
TIMEZONE="UTC"

# User/Group settings
SYSTEM_USER="root"
SYSTEM_GROUP="root"
CC_USER="ccuser"        # Generic CC user
CC_GROUP="ccgroup"      # Generic CC group
CC_USER_HOME="/home/ccuser"

# Driver versions
NVIDIA_DRIVER="535"        # NVIDIA GPU driver version
NVIDIA_CUDA="12.2"         # CUDA version
NVIDIA_CC_DRIVER="1.0"     # NVIDIA CC driver version
AMD_SEV_DRIVER="1.0"       # AMD SEV driver version

# Attestation versions
# Base attestation SDK versions
# AMD_SNP_GUEST="1.0"        # AMD SNP guest tools version
# NVIDIA_NRAS="1.0"          # NVIDIA Remote Attestation Service version
# INTEL_ITA="1.0"           # Intel Trust Authority SDK version
# MICROSOFT_MAA="1.0"       # Microsoft Azure Attestation SDK version

# Attestation SDK configurations
# SDK mappings for CPU vendors (space-separated list)
AMD_CPU_SDKS="snp-guest nras"    # SDKs to install for AMD CPU
INTEL_CPU_SDKS="ita nras"        # SDKs to install for Intel CPU

# AMD SEV-SNP
AMD_SNP_SDK_NAME="snp-guest-tools"     # Package name might change
AMD_SNP_SDK_VERSION="1.0"

# NVIDIA Remote Attestation
NVIDIA_NRAS_SDK_NAME="nvidia-cc-nras"   # Package name might change
NVIDIA_NRAS_SDK_VERSION="1.0"

# Intel Trust Authority
INTEL_ITA_SDK_NAME="intel-ita-sdk"      # Package name TBD
INTEL_ITA_SDK_VERSION="1.0"

# Microsoft Azure Attestation (if needed)
MS_MAA_SDK_NAME="ms-maa-sdk"            # Package name TBD
MS_MAA_SDK_VERSION="1.0"

# Security settings
DISABLE_SSH=true
DISABLE_SWAP=true
SECURE_KERNEL=true

# System hardening
KERNEL_MODULES_DISABLE=(
    "bluetooth"
    "thunderbolt"
    "firewire-core"
)

SYSTEM_SERVICES_DISABLE=(
    "ssh"
    "bluetooth"
    "cups"
)

# File permissions
SECURE_DIRS=(
    "/etc/attestation:${SYSTEM_USER}:${SYSTEM_GROUP}:0700"
    "/etc/cc:${SYSTEM_USER}:${SYSTEM_GROUP}:0700"     # Keep encrypted
    "/boot/cc:${SYSTEM_USER}:${SYSTEM_GROUP}:0755"    # Unencrypted config access
    "/boot/cc/tee.conf:${SYSTEM_USER}:${SYSTEM_GROUP}:0644"  # World readable
)

# Network security
ALLOWED_PORTS=(
    "22:tcp:SSH"  # Can be disabled based on DISABLE_SSH
)

# Boot security settings
SECURE_BOOT_SETTINGS=(
    "GRUB_ENABLE_VERIFICATION=y"
    "GRUB_CMDLINE_LINUX=\"... module.sig_enforce=1\""
    # Two-stage key storage:
    # 1. Sealed keys in host-visible partition
    # 2. Runtime keys in TEE memory
    "SECURE_BOOT_SEALED_KEYS=/host/cc/keys/secureboot"
    "SECURE_BOOT_RUNTIME_KEYS=${TEE_MEMORY_PATH}/keys/secureboot"
)

# Base Security Configuration

# TPM Configuration
PCR_ALLOCATIONS=(
    "0:bios"
    "1:platform"
    "2:bootloader"
    "3:secure_boot"
    "11:packages"
    "12:verity-root-hash"
)

NVRAM_INDICES=(
    "0x01500016:measurements:64"
    "0x01500017:policy:32"
    "0x01500018:boot-state:32"
)

# Secure Boot Configuration
BOOT_SIGNING_KEYS=(
    "PK:platform.key:platform.crt"      # Platform Key
    "KEK:key-exchange.key:key-exchange.crt"  # Key Exchange Key
    "DB:signature.key:signature.crt"    # Signature Database
)

# Base System Hardening
KERNEL_HARDENING=(
    "kernel.randomize_va_space=2"
    "kernel.kptr_restrict=2"
    "kernel.dmesg_restrict=1"
    "kernel.perf_event_paranoid=3"
    "kernel.yama.ptrace_scope=2"
    "fs.protected_hardlinks=1"
    "fs.protected_symlinks=1"
)

# Base Mount Options
SECURE_MOUNT_OPTIONS=(
    "nodev"
    "nosuid"
    "noexec"
)

# Essential Services (everything else disabled)
ESSENTIAL_SERVICES=(
    "systemd-journald"
    "systemd-logind"
    "cron"
    "tpm2-abrmd"
) 